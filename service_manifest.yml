name: Batchdeobfuscator
version: $SERVICE_TAG
description: >-
  This service uses the open source tool batch_deobfuscator parse and interpret batch files

accepts: code/batch
rejects: empty|metadata/.*

stage: CORE
category: Static Analysis

file_required: true
timeout: 60
disable_cache: false

enabled: true
is_external: false
licence_count: 0

heuristics:
  - description: >-
      Commands are ungrouped and normalized first. If a normalized command yield multiple groups, it may be a very strong sign of obfuscation.
    filetype: "code/batch"
    heur_id: 1
    name: Additional command grouping after command normalization
    score: 50

  - description: >-
      Those binary could be used to run script or executables. They are not often used so their usage is of interest.
    filetype: "code/batch"
    heur_id: 2
    name: Possible rare LOLBAS found
    score: 50

  - description: >-
      The executed command is generated from the content of a variable. This is a sign of obfuscation.
    filetype: "code/batch"
    heur_id: 3
    name: Execution of variable content
    score: 250

  - description: >-
      Variable usage is not surprising in a script, but the use of many of them in a single line is suspicious.
    filetype: "code/batch"
    heur_id: 4
    name: Multiple variable were used on the same line
    score: 200

docker_config:
  image: ${REGISTRY}cccs/assemblyline-service-batchdeobfuscator:$SERVICE_TAG
  cpu_cores: 1
  ram_mb: 512
